<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta name="generator" content="Hugo 0.55.3" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Python_adb | ColofulDark Blog</title>
    <meta property="og:title" content="Python_adb - ColofulDark Blog">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content="2019-04-29T10:12:15&#43;08:00">
        
        
    <meta property="article:modified_time" content="2019-04-29T10:12:15&#43;08:00">
        
    <meta name="Keywords" content="ColofulDark,java,android,博客,python">
    <meta name="description" content="Python_adb">
        
    <meta name="author" content="ColofulDark">
    <meta property="og:url" content="http://blog.harddone.com/post/python_adb/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href="/css/normalize.css">
    
        <link rel="stylesheet" href="/css/prism.css">
    
    <link rel="stylesheet" href="/css/style.css">
    <script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>

    


    
    
</head>

<body>
<header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="http://blog.harddone.com/">
                        ColofulDark Blog
                    </a>
                
                <p class="description">专注于Android、Java、Kotlin、移动互联网</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="http://blog.harddone.com/">首页</a>
                    
                    <a  href="http://blog.harddone.com/books/" title="新书">新书</a>
                    
                    <a  href="http://blog.harddone.com/archives/" title="归档">归档</a>
                    
                    <a  href="http://blog.harddone.com/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>


<div id="body">
    <div class="container">
        <div class="col-group">

            <div class="col-8" id="main">
                <div class="res-cons">
                    <article class="post">
                        <header>
                            <h1 class="post-title">Python_adb</h1>
                        </header>
                        <date class="post-meta meta-date">
                            2019年4月29日
                        </date>
                        
                        <div class="post-meta">
                            <span>|</span>
                            
                                <span class="meta-category"><a href="http://blog.harddone.com/categories/python">Python</a></span>
                            
                        </div>
                        
                        
                        <div class="post-meta">
                            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span> 阅读</span></span>
                        </div>
                        
                        
                        <div class="post-content">
                            

<h1 id="说明">说明</h1>

<p>本文以具体的python脚本为例进行说明，两个脚本都是根据开发过程中的业务需求而开发，并不具备通用性。但是其核心代码都是通过python的api执行adb命令：</p>

<pre><code>//example
cmd = 'adb shell' 
os.system(cmd)
</code></pre>

<h1 id="1-uninstall-clean-app-py">1.<code>uninstall_clean_app.py</code></h1>

<p>根据app bundle id 卸载应用，并且删除该应用在sdcard目录下生成的文件夹等。当前脚本中所删除的目录是写死的，可以根据需要自己修改。</p>

<pre><code>#!/usr/bin/python
import subprocess
import os, sys
import getopt

BASE_DIR = os.path.dirname(os.path.dirname(__file__))


if __name__ == '__main__':

	&quot;&quot;&quot; change commands and add shell&quot;&quot;&quot;

	tag = ''

	try:
		opt, args = getopt.getopt(sys.argv[1:], &quot;ht:&quot;, ['pkg', 'help'])
		for op, value in opt:
			if op in (&quot;-t&quot;, &quot;--pkg&quot;):
				tag = value
			if op in (&quot;-h&quot;, &quot;--help&quot;):
				print &quot;Usage: main_app_clean.py -t APP_PKG_NAME&quot;
				print &quot;Options:&quot;
				print &quot;  -t  APP_PKG_NAME should be a bundle id !&quot;
				print &quot;&quot;
				print &quot;Sample : ./main_app_clean.py -t &lt;bundle id&gt;&quot;
				print &quot;&quot;
				sys.exit()
	except getopt.GetoptError:  
            print &quot;Error: Could not find the args.&quot;
            print &quot;Usage: main_app_clean.py -t APP_PKG_NAME&quot;
    	    print &quot;Options:&quot;
    	    print &quot;  -t  APP_PKG_NAME should be a bundle id !&quot;
    	    print &quot;&quot;
    	    print &quot;Sample : ./main_app_clean.py -t &lt;bundle id&gt;&quot;
    	    print &quot;&quot;
    	    sys.exit()

	
	if tag == '':
		print &quot;you should input a bundle id  !&quot;
		exit()
	pkg = tag

	print ''
	print '1) uninstalling ' + pkg +' ...'
	unInstallCmd = 'adb uninstall  ' + pkg 
	os.system(unInstallCmd)

	print ''
	print '2) cleaning the cached file...'
	cleanCmd1 = 'adb shell rm -fR /sdcard/.DataBackupTest'
	os.system(cleanCmd1)
	cleanCmd2 = 'adb shell rm -fR /sdcard/.DataBackup'
	os.system(cleanCmd2)
	print ''
	print '	All done !^_^!'
	print ''

	exit()

</code></pre>

<ul>
<li><p>使用方法</p>

<ul>
<li>下载脚本到指定目录</li>
<li>打开terminal，执行cd命令到脚本所在目录</li>
<li>执行python命令 <code>python ./uninstall_clean_app.py -t com.xxx.app</code></li>
</ul>

<p><img src="https://upload-images.jianshu.io/upload_images/6174818-f6c015ef98358a93.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="01.png" /></p></li>
</ul>

<h1 id="2-obb-push-py">2.<code>obb_push.py</code></h1>

<p>该脚本作用是根据传入的obb文件完整路径，解析出app bundle id,然后将obb文件push到android设备上，减少出错机会和烦人的拷贝工作，执行该脚本可有快速完成。</p>

<pre><code>#!/usr/bin/python
import subprocess
import os, sys
import getopt

BASE_DIR = os.path.dirname(os.path.dirname(__file__))


if __name__ == '__main__':

	&quot;&quot;&quot; change commands and add shell&quot;&quot;&quot;

	tag = ''

	try:
		opt, args = getopt.getopt(sys.argv[1:], &quot;ht:&quot;, ['tag', 'help'])
		for op, value in opt:
			if op in (&quot;-t&quot;, &quot;--tag&quot;):
				tag = value
			if op in (&quot;-h&quot;, &quot;--help&quot;):
				print &quot;Usage: obb_push.py -t TAG_NAME&quot;
				print &quot;Options:&quot;
				print &quot;  -t  TAG_NAME.Choose what you want to use tag, should be a obb file path !&quot;
				print &quot;&quot;
				print &quot;Sample : ./obb_push.py -t &lt;obb file path&gt;&quot;
				print &quot;&quot;
				sys.exit()
	except getopt.GetoptError:  
            print &quot;Error: Could not find the args.&quot;
            print &quot;Usage: obb_push.py -t TAG_NAME&quot;
    	    print &quot;Options:&quot;
    	    print &quot;  -t  TAG_NAME.Choose what you want to use tag, should be a obb file path !&quot;
    	    print &quot;&quot;
    	    print &quot;Sample : ./obb_push.py -t &lt;obb file path&gt;&quot;
    	    print &quot;&quot;
    	    sys.exit()

	
	if tag == '':
		print &quot;you should input a obb file\'s path !&quot;
		exit()

	print '======to get package name=======&gt;'
	obbFilePath = tag
	if obbFilePath == '':
		print 'you should input a obb file\'s path !'
		exit()
	obbSubDirs = obbFilePath.split('/')
	# index  = len(obbSubDirs) - 1
	obbFileName = obbSubDirs[-1]
	print '&gt;&gt;&gt;obbFileName = ' + obbFileName
	if obbFileName == '' or obbFileName.find('.obb') == -1:
		print 'can not find a obb file in the path !'
		exit()
	
	tmpPackageName = obbFileName.split('.')
	print  tmpPackageName
	packageName = ''
	# for com in tmpPackageName[2:-2]:
	# 	print com
	# 	if com == tmpPackageName[-2]:
	# 	 	packageName += com
	# 	else:
	# 	 	packageName += com + &quot;.&quot; 
	packageName = '.'.join(tmpPackageName[2:-1])
	print '&gt;&gt;&gt;package name = ' + packageName


	print '=======adb shell mkdir ========&gt;'
	obbDestPath = 'sdcard/Android/obb/' + packageName
	subDir = ''
	subDirs = obbDestPath.split('/')
	for dir in subDirs:
	 	subDir += '/' + dir
	 	# print subDir 
	 	os.system('adb shell mkdir ' + subDir)

	print '=======adb push obb file to device ========&gt;'
	pushCmd = 'adb push ' + obbFilePath.replace(' ','\\ ')+ ' /' + obbDestPath + '/' 
	# print pushCmd
	os.system(pushCmd)

	exit()
</code></pre>

<ul>
<li>使用方法同上，最后执行命令 <code>python ./obb_push.py -t &lt;obb file path&gt;</code></li>
</ul>

<p><img src="https://upload-images.jianshu.io/upload_images/6174818-ac29ee1f2a26a142.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="02.png" /></p>

                        </div>

                        


                        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/about/about/">About</a></li>
        
        <li><a href="/books/books/">Books</a></li>
        
        <li><a href="/post/lua_override/">Lua 方法重载</a></li>
        
        <li><a href="/archives/">归档</a></li>
        
    </ul>
</div>


                        <div class="post-meta meta-tags">
                            
                            <ul class="clearfix">
                                
                                <li><a href="http://blog.harddone.com/tags/python">Python</a></li>
                                
                                <li><a href="http://blog.harddone.com/tags/adb">adb</a></li>
                                
                            </ul>
                            
                        </div>
                    </article>
                    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= ""
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
                </div>
            </div>
            <div id="secondary">
    <section class="widget">
        <form id="search" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="http://blog.harddone.com/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="http://blog.harddone.com/post/python_adb/" title="Python_adb">Python_adb</a>
    </li>
    
    <li>
        <a href="http://blog.harddone.com/post/lua_override/" title="Lua 方法重载">Lua 方法重载</a>
    </li>
    
</ul>
    </section>

    
<section class="widget">
    <h3 class="widget-title" style="color:red">福利派送</h3>
    <ul class="widget-list">
        
        <li>
            <a href="https://promotion.aliyun.com/ntms/yunparter/invite.html?userCode=lpl70fmt" title="领取￥1888阿里云产品通用代金券" target="_blank" style="color:red">
                
                    领取￥1888阿里云产品通用代金券
                
            </a>
        </li>
        
        <li>
            <a href="https://promotion.aliyun.com/ntms/yunparter/invite.html?userCode=lpl70fmt" title="领取￥1888阿里云产品通用代金券" target="_blank" style="color:red">
                
                    <img src="https://img.alicdn.com/tfs/TB17qJhXpzqK1RjSZFvXXcB7VXa-200-126.jpg">
                
            </a>
        </li>
        
        <li>
            <a href="https://promotion.aliyun.com/ntms/yunparter/invite.html?userCode=lpl70fmt" title="领取￥1888阿里云产品通用代金券" target="_blank" style="color:red">
                
                    <img src="https://img.alicdn.com/tfs/TB1aDXhXpzqK1RjSZFvXXcB7VXa-259-194.jpg">
                
            </a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">分类</h3>
<ul class="widget-list">
    
    <li>
        <a href="http://blog.harddone.com/categories/lua/">lua(1)</a>
    </li>
    
    <li>
        <a href="http://blog.harddone.com/categories/python/">python(1)</a>
    </li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title">标签</h3>
<div class="tagcloud">
    
    <a href="http://blog.harddone.com/tags/adb/">adb</a>
    
    <a href="http://blog.harddone.com/tags/lua/">lua</a>
    
    <a href="http://blog.harddone.com/tags/override/">override</a>
    
    <a href="http://blog.harddone.com/tags/python/">python</a>
    
    <a href="http://blog.harddone.com/tags/%E6%96%B9%E6%B3%95%E9%87%8D%E8%BD%BD/">方法重载</a>
    
</div>
    </section>

    
<section class="widget">
    <h3 class="widget-title">友情链接</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="https://blog.coderzh.com/" title="CoderZh Blog">CoderZh Blog</a>
        </li>
        
        <li>
            <a target="_blank" href="https://www.suntabu.com/" title="Suntabu Blog">Suntabu Blog</a>
        </li>
        
        <li>
            <a target="_blank" href="http://www.schunlee.ml/" title="巽&#39;s 部落格">巽&#39;s 部落格</a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="http://blog.harddone.com/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
        </div>
    </div>
</div>
<footer id="footer">
    <div class="container">
        &copy; 2019 <a href="http://blog.harddone.com/">ColofulDark Blog By ColofulDark</a>.
        Powered by <a rel="nofollow noreferer noopener" href="https://gohugo.io" target="_blank">Hugo</a>.
        <a href="https://www.flysnow.org/" target="_blank">Theme</a> based on <a href="https://github.com/rujews/maupassant-hugo" target="_blank">maupassant</a>.
        
    </div>
</footer>


    <script type="text/javascript">
    
    (function(){
        $("pre code").parent().addClass("line-numbers")
    }())

    window.MathJax = {
        tex2jax: {
            inlineMath: [ ['$','$'] ],
            processEscapes: true
        }
    };
    </script>
    <script type="text/javascript" src="/js/prism.js" async="true"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src="/js/totop.js?v=0.0.0" async=""></script>



<script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




</body>
</html>
