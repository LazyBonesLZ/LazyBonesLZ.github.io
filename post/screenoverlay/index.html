<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta name="generator" content="Hugo 0.55.3" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Android Unity Game Popups “Screen Overlay Deteched | ColorfulDark Blog</title>
    <meta property="og:title" content="Android Unity Game Popups “Screen Overlay Deteched - ColorfulDark Blog">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content="2019-08-08T09:15:12&#43;08:00">
        
        
    <meta property="article:modified_time" content="2019-08-08T09:15:12&#43;08:00">
        
    <meta name="Keywords" content="ColorfulDark,java,android,博客,python">
    <meta name="description" content="Android Unity Game Popups “Screen Overlay Deteched">
        
    <meta name="author" content="ColorfulDark">
    <meta property="og:url" content="http://www.harddone.com/post/screenoverlay/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href="/css/normalize.css">
    
        <link rel="stylesheet" href="/css/prism.css">
    
    <link rel="stylesheet" href="/css/style.css">
    <script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>

    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script async custom-element="amp-auto-ads" src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js"></script>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-5294048051542592",
        enable_page_level_ads: true
    });
    </script>
    


    
    
</head>

<body>
<header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="http://www.harddone.com/">
                        ColorfulDark Blog
                    </a>
                
                <p class="description">Focus on Android,Java,Kotlin and Mobile Internet</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="http://www.harddone.com/">Home</a>
                    
                    <a  href="http://www.harddone.com/archives/" title="Archives">Archives</a>
                    
                    <a  href="http://www.harddone.com/about/" title="About">About</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>


<div id="body">
  
  <amp-auto-ads type="adsense"
    data-ad-client="ca-pub-5294048051542592">
  </amp-auto-ads>
  
    <div class="container">
        <div class="col-group">

            <div class="col-8" id="main">
                <div class="res-cons">
                    <article class="post">
                        <header>
                            <h1 class="post-title">Android Unity Game Popups “Screen Overlay Deteched</h1>
                        </header>
                        <date class="post-meta meta-date">
                            2019-8-8
                        </date>
                        
                        <div class="post-meta">
                            <span>|</span>
                            
                                <span class="meta-category"><a href="http://www.harddone.com/categories/Android">Android</a></span>
                            
                        </div>
                        
                        
                        <div class="post-meta">
                            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span> Readers</span></span>
                        </div>
                        
                        
                        <div class="post-content">
                            <p>Gossip less, talk directly to the problem.
On the Samsung Tablet T710 device, the system version is Android 6.0.1. The game developed by the Unity engine will pop up a &ldquo;screen overlay detection&rdquo; prompt dialog when applying for Android dangerous permissions.</p>

<p>as the picture shows:</p>

<p><img src="/img/08_screenoverlay/01.png" alt="" /></p>

<p>In the face of such a clueless situation, Google Dafa is directly opened. According to the most online statement, according to the prompts, go to the Setting interface and close the app that can appear on other apps. Made, invalid. Where is the problem?</p>

<p><img src="/img/08_screenoverlay/02.png" alt="" /></p>

<p>During the test, the following conditions were found:</p>

<ul>
<li>Devices with other models above 6.0+ do not have the same problem.</li>
<li>There is no problem with the native test app on this device.</li>
</ul>

<p>Inferred that the problem may be related to Untiy&rsquo;s Android project configuration. By troubleshooting, it is not surprising that you found the following configuration in AndroidManifest.xml:</p>

<pre><code class="language-shell">&lt;!--This configuration is related to the unity item. Set whether to skip the pop-up of the permission prompt box when the app starts (please ignore other items) --&gt;
        &lt;meta-data
            Android:name=&quot;unityplayer.SkipPermissionsDialog&quot;
            Android:value=&quot;true&quot;/&gt;
</code></pre>

<p>If the configuration is cancelled, the problem is gone. However, this does not meet the project requirements, as described in the code note above. If it is removed, the app will automatically apply for permission when it is launched, even if the current logic does not use the permission. Seriously affects the user experience, so it must be retained.</p>

<p>At first I thought it was a problem with the unity5.6 version, but it also existed in the unity2018 test. Excluding the unity version problem, or at least the unity version switch, is not enough to avoid this problem. In the end, there is no way, just wondering why this &ldquo;screen overlay detection&rdquo; problem occurs. What is the root cause? Referring to the online statement, this prompt box is because there is a floating view on the screen to pop up when trying to modify the permissions. But my current screen does not have other app&rsquo;s floating window, such as 360&rsquo;s acceleration ball and other controls, it is crazy, and finally found that while the permissions dialog pops up, my application is constantly showing Toast The information requested by the ad in the application, the evil charm smiles, Toast is also a floating control?</p>

<p>*** Turn off the switch in the application to control the display of Toast, the world is clean, Amen! ***</p>

<p>Follow-up: As mentioned above, on the device, when running the native test application, the toast is displayed continuously, and the permission is applied at the same time, the dialog box of “screen overlay detection” will not pop up. It turned out that because the switch that controls whether toast is displayed is turned off by default, the pit is buried and it is also blamed for unity.</p>

<h2 id="中文">===中文===</h2>

<p>闲话少说，直接来看问题。
在三星平板T710设备上，系统版本为Android 6.0.1。Unity引擎开发的游戏在申请Android危险权限时，会弹出“屏幕重叠层检测”的提示对话框。如图所示：</p>

<p><img src="/img/08_screenoverlay/01.png" alt="" /></p>

<p>遇到这种毫无头绪的情况都是直接开启Google大法。按照网上最多的说法都是根据提示，去Setting界面将“可出现在其他app上的”app，全部关闭。做了，无效。问题在哪？</p>

<p><img src="/img/08_screenoverlay/02.png" alt="" /></p>

<p>测试过程中发现如下情况：</p>

<ul>
<li>在其他型号6.0+以上的设备却没有相同的问题。</li>
<li>在该设备上原生的测试app没有问题。</li>
</ul>

<p>推断出，该问题可能跟Untiy的Android工程配置有关。通过排查，果不其然，发现在AndroidManifest.xml中如下配置：</p>

<pre><code class="language-shell">&lt;!--此项配置跟unity 项目相关，设置在app启动时，是否跳过权限提示框的弹出（其它项目请忽略）--&gt;
        &lt;meta-data
            android:name=&quot;unityplayer.SkipPermissionsDialog&quot;
            android:value=&quot;true&quot;/&gt;
</code></pre>

<p>如果将该配置取消掉，问题就没有了。可是，这样就不满足项目需求了，原因如上代码注释所述。去掉的话，app一启动就会自动申请权限，即使当前逻辑还没用到该权限。严重影响用户体验，所以必须保留。</p>

<p>一开始以为是unity5.6版本的问题，但是在unity2018测试也一样存在。排除了unity版本问题，或者至少可以说unity版本切换，不足以避免该问题。最后实在没办法了，就在想为什么会出现这种“屏幕重叠层检测”的问题，根本原因是什么？参照网上说法，这种提示框是因为在屏幕上有悬浮视图才会在试图修改权限的时候弹出。但是我当前的屏幕上并没有其他app的悬浮窗口啊，如360的加速球之类的控件，令人抓狂，最后发现在权限对话框弹出的同时，我的应用在不停的用Toast显示应用中广告请求的信息，邪魅一笑，Toast也是悬浮控件吧？</p>

<p><strong><em>关闭应用中控制显示Toast的开关，世界清净了，阿弥陀佛！</em></strong></p>

<p>后续：上文说到，在该设备上，运行原生测试应用时，也在不停的显示toast，同时申请权限，就不会弹出“屏幕重叠层检测”的对话框。原来是因为控制toast是否显示的开关被我默认关掉了，挖坑埋自己，还归罪unity。汗！</p>
                        </div>

                        


                        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/post/kotlin_custom_btn/">Kotlin 自定义带点击效果的Button</a></li>
        
        <li><a href="/post/as_push_kotlin_jcenter/">Android Studio 3.3.2: Release Kotlin project to Jcenter</a></li>
        
        <li><a href="/post/seekbar_issue/">自定义seekbar遇到的问题</a></li>
        
        <li><a href="/post/android_https_issue/">Android https: Certificate verification failed</a></li>
        
        <li><a href="/post/nexus_private_maven/">填坑：有工程依赖时，Gradle uploadArchives to Nexus/Maven</a></li>
        
    </ul>
</div>


                        <div class="post-meta meta-tags">
                            
                            <ul class="clearfix">
                                
                                <li><a href="http://www.harddone.com/tags/Android">Android</a></li>
                                
                                <li><a href="http://www.harddone.com/tags/Unity3d">Unity3d</a></li>
                                
                                <li><a href="http://www.harddone.com/tags/%E5%B1%8F%E5%B9%95%E9%87%8D%E5%8F%A0%E5%B1%82%E6%A3%80%E6%B5%8B">屏幕重叠层检测</a></li>
                                
                                <li><a href="http://www.harddone.com/tags/Screen-Overlay-Deteched">Screen Overlay Deteched</a></li>
                                
                            </ul>
                            
                        </div>
                    </article>
                    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= ""
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
                </div>
            </div>
            <div id="secondary">
    <section class="widget">
        <form id="search" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="http://www.harddone.com/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>

    <section class="widget">
        <h3 class="widget-title">Recent articles</h3>
<ul class="widget-list">
    
    <li>
        <a href="http://www.harddone.com/post/placeholders_in_submodule/" title="Placeholders In Library Module">Placeholders In Library Module</a>
    </li>
    
    <li>
        <a href="http://www.harddone.com/post/gradle-run-adb/" title="Gradle Run Adb">Gradle Run Adb</a>
    </li>
    
    <li>
        <a href="http://www.harddone.com/post/min-api-26-bug/" title="Invoke-customs are only supported starting with android 0 --min-api 26">Invoke-customs are only supported starting with android 0 --min-api 26</a>
    </li>
    
    <li>
        <a href="http://www.harddone.com/post/FIAM_triggerEvent/" title="Firebase In-App Messaging:triggerEvent not working">Firebase In-App Messaging:triggerEvent not working</a>
    </li>
    
    <li>
        <a href="http://www.harddone.com/post/3rd_part_aar_to_nexus/" title="Nexus:Upload AAR files manully">Nexus:Upload AAR files manully</a>
    </li>
    
    <li>
        <a href="http://www.harddone.com/post/gradle_copy_file/" title="Gradle Copy File">Gradle Copy File</a>
    </li>
    
    <li>
        <a href="http://www.harddone.com/post/screenoverlay/" title="Android Unity Game Popups “Screen Overlay Deteched">Android Unity Game Popups “Screen Overlay Deteched</a>
    </li>
    
    <li>
        <a href="http://www.harddone.com/post/vysor_break/" title="最新版Vysor pro Mac Chrome插件破解">最新版Vysor pro Mac Chrome插件破解</a>
    </li>
    
    <li>
        <a href="http://www.harddone.com/post/unity_apk_reduce/" title="How to reduce the apk size of Unity Game">How to reduce the apk size of Unity Game</a>
    </li>
    
    <li>
        <a href="http://www.harddone.com/post/as_notoolchain_found/" title="No toolchains found in the NDK toolchains folder for ABI with prefix: mips64el-linux-android">No toolchains found in the NDK toolchains folder for ABI with prefix: mips64el-linux-android</a>
    </li>
    
</ul>

    </section>

    
<section class="widget">
    <h3 class="widget-title" style="color:red">福利派送</h3>
    <ul class="widget-list">
        
        <li>
            <a href="https://promotion.aliyun.com/ntms/yunparter/invite.html?userCode=lpl70fmt" title="领取￥2000阿里云产品通用代金券" target="_blank" style="color:red">
                
                    领取￥2000阿里云产品通用代金券
                
            </a>
        </li>
        
        <li>
            <a href="https://promotion.aliyun.com/ntms/yunparter/invite.html?userCode=lpl70fmt" title="领取￥2000阿里云产品通用代金券" target="_blank" style="color:red">
                
                    <img src="https://img.alicdn.com/tfs/TB17qJhXpzqK1RjSZFvXXcB7VXa-200-126.jpg">
                
            </a>
        </li>
        
        <li>
            <a href="https://promotion.aliyun.com/ntms/yunparter/invite.html?userCode=lpl70fmt" title="领取￥2000阿里云产品通用代金券" target="_blank" style="color:red">
                
                    <img src="https://img.alicdn.com/tfs/TB1aDXhXpzqK1RjSZFvXXcB7VXa-259-194.jpg">
                
            </a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">Categories</h3>
<ul class="widget-list">
    
    <li>
        <a href="http://www.harddone.com/categories/Android/">Android(20)</a>
    </li>
    
    <li>
        <a href="http://www.harddone.com/categories/Git/">Git(1)</a>
    </li>
    
    <li>
        <a href="http://www.harddone.com/categories/Lua/">Lua(1)</a>
    </li>
    
    <li>
        <a href="http://www.harddone.com/categories/Python/">Python(1)</a>
    </li>
    
    <li>
        <a href="http://www.harddone.com/categories/Unity/">Unity(1)</a>
    </li>
    
    <li>
        <a href="http://www.harddone.com/categories/Website/">Website(3)</a>
    </li>
    
</ul>

    </section>

    <section class="widget">
        <h3 class="widget-title">Tags</h3>
<div class="tagcloud">
    
    <a href="http://www.harddone.com/tags/Alpha/Bata-Test/">Alpha/Bata-Test</a>
    
    <a href="http://www.harddone.com/tags/Android/">Android</a>
    
    <a href="http://www.harddone.com/tags/Android-Studio/">Android-Studio</a>
    
    <a href="http://www.harddone.com/tags/Android-Studio-3.5/">Android-Studio-3.5</a>
    
    <a href="http://www.harddone.com/tags/Android-Studio3.3.2/">Android-Studio3.3.2</a>
    
    <a href="http://www.harddone.com/tags/Apk%E5%A4%A7%E5%B0%8F/">Apk大小</a>
    
    <a href="http://www.harddone.com/tags/Array-Params/">Array-Params</a>
    
    <a href="http://www.harddone.com/tags/Billing/">Billing</a>
    
    <a href="http://www.harddone.com/tags/CentOS/">CentOS</a>
    
    <a href="http://www.harddone.com/tags/Certificate-verification-failed/">Certificate-verification-failed</a>
    
    <a href="http://www.harddone.com/tags/Chrome-Extension/">Chrome-Extension</a>
    
    <a href="http://www.harddone.com/tags/Copy-File/">Copy-File</a>
    
    <a href="http://www.harddone.com/tags/Firebase/">Firebase</a>
    
    <a href="http://www.harddone.com/tags/GP/">GP</a>
    
    <a href="http://www.harddone.com/tags/Github/">Github</a>
    
    <a href="http://www.harddone.com/tags/Gradle/">Gradle</a>
    
    <a href="http://www.harddone.com/tags/Gradle3.3/">Gradle3.3</a>
    
    <a href="http://www.harddone.com/tags/Https/">Https</a>
    
    <a href="http://www.harddone.com/tags/IAP/">IAP</a>
    
    <a href="http://www.harddone.com/tags/In-App-Messaging-not-working/">In-App-Messaging-not-working</a>
    
    <a href="http://www.harddone.com/tags/Invoke-customs/">Invoke-customs</a>
    
    <a href="http://www.harddone.com/tags/JDK1.8/">JDK1.8</a>
    
    <a href="http://www.harddone.com/tags/Kotlin/">Kotlin</a>
    
    <a href="http://www.harddone.com/tags/Library-module/">Library-module</a>
    
    <a href="http://www.harddone.com/tags/Lua/">Lua</a>
    
    <a href="http://www.harddone.com/tags/Mac/">Mac</a>
    
    <a href="http://www.harddone.com/tags/Main-module/">Main-module</a>
    
    <a href="http://www.harddone.com/tags/Method/">Method</a>
    
    <a href="http://www.harddone.com/tags/Multiple-Module-Dependencies/">Multiple-Module-Dependencies</a>
    
    <a href="http://www.harddone.com/tags/Nexus/">Nexus</a>
    
    <a href="http://www.harddone.com/tags/Nginx/">Nginx</a>
    
    <a href="http://www.harddone.com/tags/No-toolchains-found/">No-toolchains-found</a>
    
    <a href="http://www.harddone.com/tags/Placeholders/">Placeholders</a>
    
    <a href="http://www.harddone.com/tags/Private-Maven/">Private-Maven</a>
    
    <a href="http://www.harddone.com/tags/Push-to-JCenter/">Push-to-JCenter</a>
    
    <a href="http://www.harddone.com/tags/Python/">Python</a>
    
    <a href="http://www.harddone.com/tags/Screen-Overlay-Deteched/">Screen-Overlay-Deteched</a>
    
    <a href="http://www.harddone.com/tags/Seekbar/">Seekbar</a>
    
    <a href="http://www.harddone.com/tags/Unity/">Unity</a>
    
    <a href="http://www.harddone.com/tags/Unity-Lua/">Unity-Lua</a>
    
    <a href="http://www.harddone.com/tags/Unity3d/">Unity3d</a>
    
    <a href="http://www.harddone.com/tags/Vysor-pro-2.1.7_0/">Vysor-pro-2.1.7_0</a>
    
    <a href="http://www.harddone.com/tags/Web/">Web</a>
    
    <a href="http://www.harddone.com/tags/Webhook/">Webhook</a>
    
    <a href="http://www.harddone.com/tags/Website/">Website</a>
    
    <a href="http://www.harddone.com/tags/ZXing/">ZXing</a>
    
    <a href="http://www.harddone.com/tags/Zbar/">Zbar</a>
    
    <a href="http://www.harddone.com/tags/adb/">adb</a>
    
    <a href="http://www.harddone.com/tags/compileDebugJavaWithJavac/">compileDebugJavaWithJavac</a>
    
    <a href="http://www.harddone.com/tags/git/">git</a>
    
    <a href="http://www.harddone.com/tags/google-iap/">google-iap</a>
    
    <a href="http://www.harddone.com/tags/gradle/">gradle</a>
    
    <a href="http://www.harddone.com/tags/mips64el-linux-android/">mips64el-linux-android</a>
    
    <a href="http://www.harddone.com/tags/override/">override</a>
    
    <a href="http://www.harddone.com/tags/upload-AAR-manually/">upload-AAR-manually</a>
    
    <a href="http://www.harddone.com/tags/%E5%8F%82%E6%95%B0/">参数</a>
    
    <a href="http://www.harddone.com/tags/%E5%8F%96%E6%B6%88%E8%B7%9F%E8%B8%AA/">取消跟踪</a>
    
    <a href="http://www.harddone.com/tags/%E5%B1%8F%E5%B9%95%E9%87%8D%E5%8F%A0%E5%B1%82%E6%A3%80%E6%B5%8B/">屏幕重叠层检测</a>
    
    <a href="http://www.harddone.com/tags/%E6%89%AB%E6%8F%8F%E8%A7%A3%E7%A0%81/">扫描解码</a>
    
    <a href="http://www.harddone.com/tags/%E6%95%B0%E7%BB%84/">数组</a>
    
    <a href="http://www.harddone.com/tags/%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95/">文件目录</a>
    
    <a href="http://www.harddone.com/tags/%E6%96%B9%E6%B3%95%E9%87%8D%E8%BD%BD/">方法重载</a>
    
    <a href="http://www.harddone.com/tags/%E6%97%A0%E6%B3%95%E8%B4%AD%E4%B9%B0/">无法购买</a>
    
    <a href="http://www.harddone.com/tags/%E7%A0%B4%E8%A7%A3/">破解</a>
    
    <a href="http://www.harddone.com/tags/%E7%BC%96%E8%AF%91%E9%94%99%E8%AF%AF/">编译错误</a>
    
    <a href="http://www.harddone.com/tags/%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2/">自动部署</a>
    
    <a href="http://www.harddone.com/tags/%E8%87%AA%E5%AE%9A%E4%B9%89Button/">自定义Button</a>
    
    <a href="http://www.harddone.com/tags/%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%9B%E5%BA%A6%E6%9D%A1/">自定义进度条</a>
    
    <a href="http://www.harddone.com/tags/%E8%AF%81%E4%B9%A6%E9%AA%8C%E8%AF%81%E5%A4%B1%E8%B4%A5/">证书验证失败</a>
    
</div>

    </section>

    
<section class="widget">
    <h3 class="widget-title">Links</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="https://www.suntabu.com/" title="Suntabu Blog">Suntabu Blog</a>
        </li>
        
        <li>
            <a target="_blank" href="http://www.schunlee.ml/" title="巽&#39;s 部落格">巽&#39;s 部落格</a>
        </li>
        
        <li>
            <a target="_blank" href="https://blog.coderzh.com/" title="CoderZh Blog">CoderZh Blog</a>
        </li>
        
    </ul>
</section>



    <section class="widget">
        <h3 class="widget-title">Others</h3>
        <ul class="widget-list">
            <li><a href="http://www.harddone.com/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>

        </div>
    </div>
</div>
<footer id="footer">
    <div class="container">
        &copy; 2019 <a href="http://www.harddone.com/">ColorfulDark Blog By ColorfulDark</a>.
        Powered by <a rel="nofollow noreferer noopener" href="https://gohugo.io" target="_blank">Hugo</a>.
        <a href="https://www.flysnow.org/" target="_blank">Theme</a> based on <a href="https://github.com/rujews/maupassant-hugo" target="_blank">maupassant</a>.
        
    </div>
</footer>


    <script type="text/javascript">
    
    (function(){
        $("pre code").parent().addClass("line-numbers")
    }())

    window.MathJax = {
        tex2jax: {
            inlineMath: [ ['$','$'] ],
            processEscapes: true
        }
    };
    </script>
    <script type="text/javascript" src="/js/prism.js" async="true"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src="/js/totop.js?v=0.0.0" async=""></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-139304185-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



<script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




</body>
</html>
